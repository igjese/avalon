<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">
    
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">

    <title>FSS Adequate</title>
</head>

<body>

<nav class="navbar navbar-expand-sm navbar-light bg-light py-0 mb-2 justify-content-between">
    <a class="navbar-brand" href="/game/"><em class="fa fa-jedi"></em> FSS Adequate</a>
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" href="/game/debug/">Debug</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/game/restart/">Restart</a>
        </li>
    </ul>
</nav>

<div class="container m-3">
    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link " id="logs-tab" data-toggle="tab" href="#logs">Logs</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="data-tab" data-toggle="tab" href="#data">Data</a>
        </li>
    </ul>

    <div class="tab-content">
        <div id="logs" class="tab-pane fade in active">
            <!-- Logs will go here -->
            <table id="logTable" class="display small">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Tick</th>
                        <th>Level</th>
                        <th>Message</th>
                    </tr>
                </thead>
            </table>
        </div> <!-- Logs -->

        <div id="data" class="tab-pane fade">
            <h4 class="mt-3">Utilities</h4>
            <button id="getData" class="btn btn-primary">Get Data</button>
            <div id="dataContainer"></div>  <!-- This is where we'll display the data -->
        </div> <!-- Data -->
    </div>


</div> <!-- Container -->


<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

<!-- DataTables JS --> 
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

<script>
$(document).ready(function() {
    // Initialize DataTable
    table = $('#logTable').DataTable({
        "pageLength": 10000,  // Show 10000 rows per page
        "lengthChange": false,  // Remove the dropdown menu
        "ajax": {
            "url": "/game/logs/",  // Replace with the actual path to your `get_logs` view
            "dataSrc": "data"
        },
        "columns": [
            { "data": "timestamp" },
            { "data": "tick" },
            { "data": "level" },
            { "data": "message" }
        ],
        "order": [[0, "desc"]],  // Sort by tick, descending
    });

    // Manually click the logs tab
    $('#logs-tab').tab('show');

    // Get Data button click event
    $('#getData').click(function() {
        $.ajax({
            url: '/game/datadump/',  // Replace with the actual path to your Django view
            method: 'GET',
            success: function(response) {
                // Handle the returned data (assuming it's JSON)
                // Convert it to a nicely formatted string
                const dataString = JSON.stringify(response, null, 4);
                
                // Display it in a div or some other HTML element
                $('#dataContainer').html('<pre>' + dataString + '</pre>');
                
                // Copy dataString to clipboard
                copyToClipboard(dataString);
            },
            error: function(error) {
                alert('An error occurred');
            }
        });
    });

    // Function to copy text to clipboard
    function copyToClipboard(text) {
        var textArea = document.createElement("textarea");
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('Data copied to clipboard.');
    }


});
</script>

</body>
</html>
